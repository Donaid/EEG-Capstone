<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/profilePage.css'%}">
    <title>Profile Page</title>
</head>
<body onload="timer1()">
  
  <!---Navigationbar-->

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-lg">
    <div class="container">
      <a class="navbar-brand" href="{% url 'homePage' %}">SADA</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nm">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nm">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link contr1 text-light" href="{% url 'homePage'%}" id="Home">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link contr1 text-light" href="{% url 'logout'%}" id="Login">Logout</a>
          </li>
        </ul>
      </div>

    </div>
  </nav>

  <!---Container for all the information-->
  <div class="container my-4">
    <!--- first row for profile summary, learning method summary and pie chart graph --->
    <div class="row">
      <!---first column for profile summary-->
      <div class="col-sm-6 col-md-4 col-lg-4 ps-0 pe-0 me-0 ms-0 mb-2 addP1">
        <div class="border rounded shadow me-2 ms-2 h-100 addBorder1 addPadding1">
          <div class="card border-0 bg-transparent">
            <div class="card-body" style="text-align: center;">
              <h5 class="card-title">Profile Summary<hr></h5>
              <ul class="list-group list-group-flush">
                <li class="list-group-item mb-2" id="userName">Username :</li>
                <li class="list-group-item mb-2" id="idealStudyTime">Ideal Study Time:</li>
                <li class="list-group-item mb-2">Highest Consecutive Attention :</li>
                <li class="list-group-item mb-3 mt-2">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item mb-2 text-danger" id="consecutiveHighAttentionAV">Aural/Visual :</li>
                    <li class="list-group-item mb-2 text-primary" id="consecutiveHighAttentionRW">Read/Write :</li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <!---Second column for learning method summary-->
      <div class="col-sm-6 col-md-4 col-lg-4 ps-0 pe-0 me-0 ms-0 mb-2 addP1">
        <div class="me-2 ms-2 border border-end-0 rounded shadow h-100 addBorder1 addPadding1">
          <div class="card border-0 bg-transparent">
            <div class="card-body" style="text-align: center;">
              <h5 class="card-title">Learning Method Summary<hr></h5>
              <ul class="list-group list-group-flush">
                <li class="list-group-item mb-2">Sessions Completed :</li>
                <li class="list-group-item mb-2 mt-2">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item mb-2 text-danger" id="sessionsCompletedAV">Aural/Visual :</li>
                    <li class="list-group-item mb-2 text-primary" id="sessionsCompletedRW">Read/Write :</li>
                  </ul>
                </li>
                <li class="list-group-item mb-2">High to Total Attention Percentage :</li>
                <li class="list-group-item mb-2">
                  <ul class="list-group list-group-flush mt-2">
                    <li class="list-group-item mb-2 text-danger" id="highToTotalAV">Aural/Visual :</li>
                    <li class="list-group-item mb-2 text-primary" id="highToTotalRW">read/Write:</li>
                  </ul>
                </li>
              </ul>
              </div>
          </div>
        </div>
      </div>
      
      <!---third column for pie chart graph-->
      <div class="col-sm-12 col-md-4 col-lg-4 ps-0 pe-0 me-0 ms-0 mb-2">
        <div class="me-2 ms-2 border rounded shadow h-100 addBorder1 pb-2">
          <h5 class="pt-3" style="text-align: center;">Total Attention High/Total</h5>
            <canvas id="pieChart1"></canvas>
        </div>
      </div>
  
    </div>
  
    <!---second row for title and date selection of bottom graphs-->
    <div class="row" style="margin-top: 10px;">
      <div class="col-12 pe-0 ps-0 me-0 ms-0 mb-2">
        <div class="border shadow-lg rounded me-2 ms-2 addBorder2">
          <h5 style="text-align: center;" class="mt-3">
          Attention Level Summary
          </h5>
          <div class="ms-2 my-2">
            <img style="width: 30px;" src="https://img.icons8.com/material-outlined/24/fa314a/filled-circle--v1.png"/>
            Aural/Visual Learning
            <img style="width: 30px;" src="https://img.icons8.com/ios-filled/50/4a90e2/filled-circle.png"/>
            Read/Write Learning Mode
          </div>
          <br>
          <div>
            <div class="input-group mb-3 pe-2 ps-2">
              <span class="input-group-text">Enter Date for Summary</span>
              <input type="date" class="form-control" style="outline: none; box-shadow: none;" placeholder="Enter date in the formal dd-mm-yyyy" id="dateSelected1">
              <button class="btn-primary btn" onclick="changeData()">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!---third row for bottom graphs-->
    <div class="row" style="margin-top: 10px;">
      <div class="col-sm-12 col-md-6 col-lg-4 mb-2 pe-0 ps-0 ms-0 me-0 addP2">
        <div class="me-2 ms-2 rounded border-0 shadow-lg addBorder2">
          <div class="card border-0 bg-transparent">
            <div class="card-body" style="text-align: center;">
              <h5 class="card-title">Daily Sessions<hr></h5>
              <div class="d-flex justify-content-center" style="height: 300px;">
                <div><canvas id="dailySessionsChart" class="bg-dark rounded"></canvas></div>
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <div class="col-sm-12 col-md-6 col-lg-4 mb-2 pe-0 ps-0 ms-0 me-0 addP2">
        <div class="me-2 ms-2 rounded border-0 shadow-lg addBorder2 ">
          <div class="card border-0 bg-transparent">
            <div class="card-body" style="text-align: center;">
              <h5 class="card-title">Daily<hr></h5>
              <div class="d-flex justify-content-center" style="height: 300px;">
                <div><canvas id="dailyChart" class="bg-dark rounded"></canvas></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    
      <div class="col-sm-12 col-md-12 col-lg-4 mb-2 pe-0 ps-0 ms-0 me-0">
        <div class="me-2 ms-2 rounded border-0 shadow-lg addBorder2">
          <div class="card border-0 bg-transparent">
            <div class="card-body" style="text-align: center;">
              <h5 class="card-title">Weekly<hr></h5>
              <div class="d-flex justify-content-center" style="height: 300px;"> 
                <div><canvas id="weeklyChart" class="bg-dark rounded"></canvas></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!--Modal-->
  <div class="modal fade shadow-lg" tabindex="-1" id="errorModal">
    <div class="modal-dialog">
      <div class="modal-content" style="border-radius:0.5rem; text-align: center;">
        <div class="modal-header">
          <h5 class="modal-title" style="margin: auto;">Error</h5>
          <button type="button" class="btn-primary rounded border-0" onclick="closeErrorModal()">
          &times;
          </button>
        </div>
        <div class="modal-body">
          <p class="text-danger">Data for the selected date was not found!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="closeErrorModal()">Close</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

<script>

//-------------------------------------------Pie Chart Graph------------------------------------------------
const ch1 = document.getElementById('pieChart1').getContext('2d');
var hLChart = new Chart(ch1,{
  type:'pie',
  data:{
    labels:[
      'High Attention',
      'Low Attention'
    ],
    datasets:[{
      label:'Total Attention High/Low',
      data:[50,50],
      backgroundColor:[
        'rgb(0, 0, 255)',
        'rgb(255, 0, 0)'
      ],
      hoverOffset:2
    }] 
  },
});

//--------------------------------------Updating Pie Chart Graph and Data on top row-----------------------------------------------------

const userName=document.getElementById('userName');
const idealStudyTime=document.getElementById('idealStudyTime');
const audioVideoHighAttention=document.getElementById('consecutiveHighAttentionAV');
const readWriteHighAttention=document.getElementById('consecutiveHighAttentionRW');
const sessionsCompletedAV=document.getElementById('sessionsCompletedAV');
const sessionsCompletedRW=document.getElementById('sessionsCompletedRW');
const highToTotalAV=document.getElementById('highToTotalAV');
const highToTotalRW=document.getElementById('highToTotalRW');

// var person2 = JSON.parse("{{ personJson|escapejs }}");

// value1 = person2['userName'];
// value2 = parseInt(person2['idealStudyTime']);
// value3 = parseInt(person2['audioVideoHighAttention']);
// value4 = parseInt(person2['readWriteHighAttention']);
// value5 = parseInt(person2['sessionsCompletedAV']);
// value6 = parseInt(person2['sessionsCompletedRW']);
// value7 = parseInt(person2['highToTotalAV']);
// value8 = parseInt(person2['highToTotalRW']);
// value9 = parseInt(person2['graphHighAttention']);
// value10 = parseInt(person2['graphLowAttention']);

//Object that contains all the data
// let userData={
//   userName:person2.userName,
//   idealStudyTime:"12:00 PM",
//   audioVideoHighAttention:30,
//   readWriteHighAttention:43,
//   sessionsCompletedAV:person2.sessionsCompletedAV,
//   sessionsCompletedRW:person2.sessionsCompletedRW,
//   highToTotalAV:person2.highToTotalAV,
//   highToTotalRW:person2.highToTotalRW,
//   graphHighAttention:person2.graphHighAttention,
//   graphLowAttention:person2.graphLowAttention
// }
let userData = {}

//function for updating piechart
function updateChart(){
    hLChart.data.datasets[0].data[0]=userData.graphHighAttention;
    hLChart.data.datasets[0].data[1]=userData.graphLowAttention;
    hLChart.update();
};

//function for updating profile summary and learning method summary
function updateData(){
  userName.innerHTML='Username : ' + userData.userName;
  idealStudyTime.innerHTML='Ideal Study Time : ' + userData.idealStudyTime;
  audioVideoHighAttention.innerHTML='Aural/Visual : ' + userData.audioVideoHighAttention
  readWriteHighAttention.innerHTML='Read/Write : ' + userData.readWriteHighAttention
  sessionsCompletedAV.innerHTML='Aural/Visual : ' + userData.sessionsCompletedAV
  sessionsCompletedRW.innerHTML='Read/Write : ' + userData.sessionsCompletedRW
  highToTotalAV.innerHTML='Aural/Visual : ' + userData.highToTotalAV
  highToTotalRW.innerHTML='Read/Write : ' + userData.highToTotalRW
};

//----------------------Daily Sessions Chart---------------------------------------------

const ch2 = document.getElementById('dailySessionsChart').getContext('2d');
var dSChart=new Chart(ch2,{
  type:'bar',
  data:{
    labels:[["session 1"], ["session 2"], ["session 3"], ["session 4"]],
    datasets:[{
      data:[0, 0, 0, 0],
      backgroundColor: [
          'rgba(255,0,0,0.5)',
          'rgba(0,0,255,0.5)',
          'rgba(255,0,0,0.5)',
          'rgba(0,0,255,0.5)',
      ]
    }]
  },
  options:{
    scales:{
      y:{
        beginAtZero: true,
        max:100,
        title:{
          display:true,
          text:'Attention Level'
        }
      },
    },
    maintainAspectRatio:false,
    responsiveness:true,
    plugins:{
      legend:{
        display:false,
      }
    }   
  },
});

//----------------------Daily Chart---------------------------------------------

const ch3 = document.getElementById('dailyChart').getContext('2d');
var dChart = new Chart(ch3,{
  type:'bar',
  data:{
    labels:['High Attention', 'Low Attention','High Attention','Low Attention'],
    datasets:[{
      data:[0, 0, 0, 0],
      backgroundColor: [
        'rgba(255,0,0,0.5)',
        'rgba(255,0,0,0.5)',
        'rgba(0,0,255,0.5)',
        'rgba(0,0,255,0.5)',
      ]
    }]
  },
  options:{
    scales:{
      y:{
        beginAtZero: true,
        max:100,
      },
    },
    maintainAspectRatio:false,
    responsiveness:true,
    plugins:{
      legend:{
        display:false,
      }
    },    
  },
});


//----------------------Weekly Chart---------------------------------------------

const ch4 = document.getElementById('weeklyChart').getContext('2d');
var wChart = new Chart(ch4,{
  type:'bar',
  data:{
    labels:['High Attention', 'Low Attention','High Attention','Low Attention'],
    datasets:[{
      data:[0, 0, 0, 0],
      backgroundColor:[
        'rgba(255,0,0,0.5)',
        'rgba(255,0,0,0.5)',
        'rgba(0,0,255,0.5)',
        'rgba(0,0,255,0.5)',
      ]
    }]
  },
  options:{
    scales:{
      y:{
        beginAtZero: true,
        max:100,
      },
    },
    maintainAspectRatio:false,
    responsiveness:true,
    plugins:{
      legend:{
        display:false,
      }
    }     
  },
});

//----------------------Updating the Bottom 3 Graphs---------------------------------------------

const date1=document.getElementById('dateSelected1');
let errorModal = new bootstrap.Modal(document.getElementById("errorModal"), {});
// date1.value = person2.date

// let graphData1={
//   learningMode:['r','w','r','r'],
//   dailySessionData:[76,41,89,17],//the attention values for daily sessions
//   daily:[70,30,80,20],//the attention values for the overall day
//   weekly:[15,85,28,72]//the attention values for the overall week
// }

//object that contains data for bottom three graphs
// let graphData1={
//   learningMode: person2.learningMode,
//   dailySessionData: person2.dailySessionData,//the attention values for daily sessions
//   daily: person2.daily,//the attention values for the overall day
//   weekly:[15,85,28,72]//the attention values for the overall week
// }

let graphData1 = {}

//function that fills daily sessions graph
function fillDailySessionsGraph(){
  chartLabelsTemp=[]
  dSChart.data.datasets[0].backgroundColor=[]
  dSChart.data.datasets[0].data=[]

  for(i=0;i<graphData1.dailySessionData.length;i++){
    chartLabelsTemp.push('session ' + (i+1));
    dSChart.data.datasets[0].data.push(graphData1.dailySessionData[i])
    
    if(graphData1.learningMode[i]==='r'){
      dSChart.data.datasets[0].backgroundColor.push('rgba(0,0,255,0.5)')
    }
    else{
      dSChart.data.datasets[0].backgroundColor.push('rgba(255,0,0,0.5)');
    }
  }
  
  dSChart.data.labels=chartLabelsTemp;
  dSChart.update()
}

//function that fills daily Graph
function fillDailyGraph(){
  dChart.data.datasets[0].data=[]
  
  for(i=0;i<graphData1.daily.length;i++){
    dChart.data.datasets[0].data.push(graphData1.daily[i])
  }
  dChart.update()
}

//function that fills weekly graph
function fillWeeklyGraph(){
  wChart.data.datasets[0].data=[]
  
  for(i=0;i<graphData1.weekly.length;i++){
    wChart.data.datasets[0].data.push(graphData1.weekly[i])
  }
  wChart.update()
}

//updates all the bottom three graphs
function updateAll(){
  fillDailySessionsGraph()
  fillDailyGraph()
  fillWeeklyGraph()
}


function timer1(){
  $.ajax(
  {
    type:"POST",
    url: "/test1/updateprofiledata/",
    mode: 'same-origin',
    headers: {
      "X-CSRFToken" : getCookie('csrftoken')
    },
    success: function(data) {
      console.log('onload data', data);
      userData = {
        userName: data.userName,
        idealStudyTime: data.idealStudyTime,
        audioVideoHighAttention: data.audioVideoHighAttention,
        readWriteHighAttention: data.readWriteHighAttention,
        sessionsCompletedAV: data.sessionsCompletedAV,
        sessionsCompletedRW: data.sessionsCompletedRW,
        highToTotalAV: data.highToTotalAV,
        highToTotalRW: data.highToTotalRW,
        graphHighAttention: data.graphHighAttention,
        graphLowAttention: data.graphLowAttention
      }

      date1.value = data.date
      graphData1 = {
        learningMode: data.learningMode,
        dailySessionData: data.dailySessionData,//the attention values for daily sessions
        daily: data.daily,//the attention values for the overall day
        weekly: data.weekly//the attention values for the overall week
      }
      updateChart();
      updateData();
      updateAll();
    }
  })
  // setTimeout(updateChart,1000)
  // setTimeout(updateData,1000)
  // setTimeout(updateAll,1000)
}

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}


function changeData(){//this function is for when the user selects Date

  $.ajax(
  {
    type:"POST",
    url: "/test1/updateprofiledata/",
    // url: "/test1/getprofiledata/",
    mode: 'same-origin',
    headers: {
      "X-CSRFToken" : getCookie('csrftoken')
    },
    data: {
      targetDate : date1.value
    },
    success: function(data) {
      console.log("filter", data);
      if(data.dataAvailable == 1){
        //update this object with new date
        // graphData1={
        //   learningMode:['r','w','r','w'],
        //   dailySessionData:[10,10,10,10],//the attention values for daily sessions
        //   daily:[10,10,10,10],//the attention values for the overall day
        //   weekly:[10,10,10,10]//the attention values for the overall week

        // }
        graphData1.learningMode = data.learningMode;
        graphData1.dailySessionData = data.dailySessionData;
        graphData1.daily = data.daily;
        graphData1.weekly = data.weekly;
        updateAll();
      }
      else if(data.dataAvailable == 0) {
        // date1.value = data.date;
        errorModal.show();
      }
    }
  })
  // dateFound = true;
  // date1.value



}


function closeErrorModal(){
  errorModal.hide()
}

</script>
</body>

</html>
